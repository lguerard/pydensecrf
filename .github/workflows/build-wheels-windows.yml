# This workflow builds Python wheels for Windows using cibuildwheel
# See: https://cibuildwheel.readthedocs.io/en/stable/

name: Build wheels (Windows)

on:
  workflow_dispatch:
  push:
    branches: [ main, master, test_ga_build ]
  pull_request:
    branches: [ main, master, test_ga_build ]

jobs:
  build_wheels:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    - name: Build wheels with cibuildwheel
      uses: pypa/cibuildwheel@v2.23.3
      with:
        output-dir: wheelhouse
      env:
        CIBW_BUILD: cp39-win_amd64 cp310-win_amd64 cp311-win_amd64 cp312-win_amd64
    - name: Upload wheels for each Python version
      run: |
        for whl in wheelhouse/*.whl
        set whl_name (basename $whl)
        echo "Uploading $whl_name"
        gh release upload temp-release $whl --clobber || true
        echo "::group::Upload $whl_name"
        echo "::endgroup::"
      shell: bash
    - name: Upload wheels as separate artifacts
      run: |
        for whl in wheelhouse/*.whl; do
          whl_name=$(basename "$whl" .whl)
          echo "Uploading $whl as $whl_name"
          mkdir -p artifacts/$whl_name
          cp "$whl" artifacts/$whl_name/
        done
      shell: bash
    - name: Upload all wheel artifacts
      uses: actions/upload-artifact@v4
      with:
        path: artifacts/*/*.whl
